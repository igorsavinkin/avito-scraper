# Парсер Avito.ru

Парсер для сбора данных об объявлениях о сдаче квартир посуточно в Волгограде с сайта Avito.ru.

## Возможности

- Автоматический запуск браузера в фоновом режиме
- Сбор данных: заголовок, цена, URL фотографии
- Сохранение данных в SQLite базу данных
- Сохранение и загрузка куки для избежания блокировок
- Структурированный код с использованием ООП

## Установка

### Вариант 1: Автоматическая установка (рекомендуется)

**Для Windows (PowerShell):**
```powershell
.\setup.ps1
```

**Для Windows (CMD):**
```cmd
setup.bat
```

### Вариант 2: Ручная установка

1. Убедитесь, что у вас установлен Python 3.7+

2. Создайте виртуальное окружение:
```bash
python -m venv venv
```

3. Активируйте виртуальное окружение:

**Windows (PowerShell):**
```powershell
.\venv\Scripts\Activate.ps1
```

**Windows (CMD):**
```cmd
venv\Scripts\activate.bat
```

**Linux/macOS:**
```bash
source venv/bin/activate
```

4. Обновите pip:
```bash
python -m pip install --upgrade pip
```

5. Установите зависимости:
```bash
pip install -r requirements.txt
```

## Структура проекта

```
avito-bot/
├── main.py                 # Основной файл с интерфейсом
├── scraper.py              # Класс для управления браузером Selenium
├── html_parser.py          # Класс для парсинга HTML с BeautifulSoup
├── db.py                   # Класс для работы с SQLite базой данных
├── requirements.txt        # Зависимости проекта
├── setup.bat              # Скрипт установки для Windows (CMD)
├── setup.ps1              # Скрипт установки для Windows (PowerShell)
├── check_dependencies.py  # Проверка установленных зависимостей
├── .gitignore            # Исключения для Git
├── README.md             # Основная документация
├── INSTALL.md            # Подробная инструкция по установке
└── COMMANDS.md           # Полезные команды
```

## Использование

### Запуск программы

```bash
python main.py
```

### Меню программы

1. **Запустить парсинг** - основной режим работы
2. **Показать все данные** - просмотр сохраненных данных
3. **Очистить базу данных** - удаление всех записей
4. **Выход** - завершение работы

### Программное использование

```python
from main import AvitoBot

# Создание экземпляра бота
bot = AvitoBot(headless=True)  # headless=True для фонового режима

# Запуск парсинга
bot.run()

# Просмотр данных
bot.show_all_data()

# Очистка базы
bot.clear_database()
```

## База данных

Данные сохраняются в файл `avito_data.db` со следующей структурой:

| Поле | Тип | Описание |
|------|-----|----------|
| id | INTEGER | Уникальный идентификатор |
| title | TEXT | Заголовок объявления |
| price | TEXT | Цена |
| photo_url | TEXT | URL фотографии |
| created_at | TIMESTAMP | Дата создания записи |

## Файлы

- `avito_data.db` - база данных SQLite
- `avito_cookies.pkl` - сохраненные куки браузера

## Особенности

### Обработка блокировок

- При первом запуске сохраняются куки браузера
- При последующих запусках куки загружаются автоматически
- Это помогает избежать блокировок от Avito

### Настройки браузера

- Браузер запускается в фоновом режиме (headless)
- Отключены изображения для ускорения загрузки
- Установлен реалистичный User-Agent
- Настроены дополнительные опции для стабильности

### Парсинг данных

- Использует несколько селекторов для поиска элементов
- Обрабатывает различные варианты структуры страницы
- Извлекает заголовки, цены и URL фотографий
- Очищает данные от лишних символов

## Устранение неполадок

### Ошибки при запуске браузера

1. Убедитесь, что Chrome установлен
2. Проверьте подключение к интернету
3. Попробуйте запустить с `headless=False` для отладки

### Проблемы с парсингом

1. Структура сайта могла измениться
2. Проверьте, что URL актуален
3. Запустите с `headless=False` для визуальной отладки

### Блокировки

1. Удалите файл `avito_cookies.pkl`
2. Используйте VPN или прокси
3. Увеличьте задержки между запросами

## Требования

- Python 3.7+
- Google Chrome
- Интернет-соединение

## Зависимости

**Обязательные:**
- selenium==4.15.2
- beautifulsoup4==4.12.2
- webdriver-manager==4.0.1

**Опциональные:**
- lxml>=4.9.0 (для более быстрого парсинга, если не установлен - используется встроенный html.parser)

## Лицензия

Проект создан в образовательных целях. Соблюдайте правила использования сайта Avito.ru.
